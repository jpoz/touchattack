var mode="defend",gameSpeed=1E3,boxSize=80,benchSize=15,refreshRate=1E3,refreshAmount=50,shotCost=20,blockValue=10,gameLength=3E4,levels={level1:[[4100,333,121],[5100,192,93],[6100,263,139],[7100,178,193],[8100,288,44],[9100,53,194],[10100,211,131],[11100,222,161],[12100,53,60],[13100,243,198],[14100,270,167],[15100,151,164],[16100,92,121],[17100,274,117],[18100,255,171],[19100,230,136],[20100,153,173],[21100,292,133],[22100,78,91],[23100,258,49],[24100,249,118],[25100,87,197],[26100,339,170],[27100,
58,130],[28100,210,130],[29100,196,161],[30100,237,113],[31100,283,125],[32100,53,158]],level2:[[4100,169,108],[4500,321,111],[4900,330,99],[5300,157,74],[5700,208,98],[6100,285,158],[6500,68,199],[6900,79,125],[7300,294,51],[7700,199,57],[8100,339,50],[8500,298,42],[8900,242,83],[9300,253,67],[9700,244,142],[10100,144,88],[10500,317,46],[10900,346,122],[11300,136,67],[11700,354,136],[12100,142,180],[12500,115,79],[12900,218,73],[13300,149,139],[13700,114,80],[14100,316,174],[14500,192,106],[14900,
128,198],[15300,339,191],[15700,117,124],[16100,75,95],[16500,179,51],[16900,43,53],[17300,321,161],[17700,95,180],[18100,302,183],[18500,82,42],[18900,323,178],[19300,92,68],[19700,140,113],[20100,91,73],[20500,252,95],[20900,325,110],[21300,237,182],[21700,327,88],[22100,118,156],[22500,197,47],[22900,324,99],[23300,131,171],[23700,154,99],[24100,74,45],[24500,133,122],[24900,57,56],[25300,236,136],[25700,235,155],[26100,329,52],[26500,348,79],[26900,189,90],[27300,93,197],[27700,329,119],[28100,
229,144],[28500,131,71],[28900,152,160],[29300,295,127],[29700,219,152],[30100,301,173],[30500,277,133],[30900,56,140],[31300,47,175],[31700,231,184],[32100,279,138],[32500,80,164]]},red="#DE4448",green="#51B45B",yellow="#DECE67",blue="#5E84BE",powerDiv,game_board,gameStartTime,attackSequence=[],bench=[],powerLevel=100,currentTouches=[],gameActive=false,blockedCount=0,totalCount=0,debugDiv;$(document).ready(function(){TouchAttack.setup()});
var TouchAttack={setup:function(){if(navigator.appVersion.indexOf("iPhone OS ")<0)this.warn("Oops come back to this site on your iPhone or iPod Touch.");else{document.addEventListener("touchmove",TouchAttack.disableTouch,false);if(window.navigator.standalone){window.onorientationchange=TouchAttack.onorientationchange;this.onorientationchange();for(var a=benchSize;a>0;a--){var b=$.engineer.make("attack_square",{onTouchStartFuntion:TouchAttack[mode],onTouchEndFuntion:TouchAttack["un"+mode]});$("body").append(b);
bench.push(b)}game_board=document.getElementById("game_board");document.body.ontouchstart=TouchAttack.disableTouch;powerDiv=$("#powerLevel");debugDiv=$("#debug");powerDiv.css("width",powerLevel+"%");document.getElementById("level1start").ontouchend=function(){TouchAttack.start(1)};document.getElementById("level2start").ontouchend=function(){TouchAttack.start(2)};document.getElementById("reload").ontouchend=function(){location.reload(true)}}else this.warn('Click the + and select "Add to Home Screen" to install TouchAttack')}},
warn:function(a){$("#warning").fadeIn().find("#warningText").text(a)},unwarn:function(){$("#warning").fadeOut();$("#game").fadeIn()},onorientationchange:function(){window.scrollTo(0,1);0==90%window.orientation?TouchAttack.unwarn():TouchAttack.warn("This game is meant to be played in landscape. Please rotate your device.")},start:function(a){$("#Level").text("Level "+a);attackSequence=levels["level"+a];totalCount=attackSequence.length;TouchAttack.moveMenuTo(-320);setTimeout(TouchAttack.moveMenuTo,
1E3,-640);setTimeout(TouchAttack.moveMenuTo,2E3,-960);setTimeout(TouchAttack.moveMenuTo,3E3,-1280);setTimeout(TouchAttack.moveMenuTo,4E3,-1920);setTimeout(TouchAttack.startTimer,4E3);this[mode+"Start"]()},startTimer:function(){timerDiv=$("#timerLevel");timerDiv.css({width:"0%","background-color":red});setTimeout(TouchAttack.gameOver,gameLength);gameStartTime=new Date},attackStart:function(){attackSequence=[];game_board.ontouchstart=TouchAttack.attack;game_board.ontouchmove=TouchAttack.disableTouch;
setTimeout(TouchAttack.refreshPower,refreshRate);gameActive=true},attack:function(a){a.preventDefault();$.each(a.touches,function(b,c){b=c.pageX-boxSize/2;c=c.pageY-boxSize/2;bench.push(bench.shift().send("attack",b,c));attackSequence.push([new Date-gameStartTime,b,c])})},unattack:function(a){a.preventDefault()},defendStart:function(){game_board.ontouchstart=TouchAttack.disableTouch;game_board.ontouchmove=TouchAttack.disableTouch;$.each(attackSequence,function(a,b){setTimeout(TouchAttack.shoot,b.shift(),
b.shift(),b.shift())});gameActive=true},defend:function(a){a.preventDefault();$(this).css({"background-color":yellow})},undefend:function(){$(this).css("display","none").data("touched",true)},shoot:function(a,b){if(gameActive){a=bench.shift().send("shoot",a,b);bench.push(a);setTimeout(TouchAttack.blocked,gameSpeed,a)}},blocked:function(a){if(a.data("touched")){blockedCount++;powerDiv.css("background",green);powerLevel+=blockValue;if(powerLevel>100)powerLevel=100}else{a.css("background",red);powerDiv.css("background",
red);powerLevel-=shotCost}powerDiv.css("width",powerLevel+"%");powerLevel<1&&TouchAttack.gameOver()},powerReady:function(){return!!(powerDiv.width()>shotCost/480&powerLevel>shotCost)},refreshPower:function(){powerLevel+=refreshAmount;powerLevel>shotCost&&powerDiv.css("background-color",green);if(powerLevel>100)powerLevel=100;powerDiv.css("width",powerLevel+"%");setTimeout(TouchAttack.refreshPower,refreshRate)},gameOver:function(){if(gameActive){gameActive=false;game_board.ontouchstart=function(){};
$("#results").css("top",0);$("#blocked").text(blockedCount);$("#total").text(totalCount)}},disableTouch:function(a){a.preventDefault()},moveMenuTo:function(a){$("#menu").css("top",a)}};
$.engineer.define("attack_square",{defaults:{onTouchStartFuntion:function(){},onTouchEndFuntion:function(){}},structure:function(){return $("<div/>",{css:{background:blue,position:"absolute",top:-9,left:0,width:"1px",height:"1px"}})},behavior:function(a){var b=this,c={attack:function(d,e){b.css({top:e,left:d,"-webkit-animation-name":"shrink","-webkit-animation-duration":gameSpeed/1E3+"s"})},shoot:function(d,e){b.data("touched",false);b.css({display:"block",background:blue,top:e,left:d,"-webkit-animation-name":"grow",
"-webkit-animation-duration":gameSpeed/1E3+"s"})}};b[0].ontouchstart=a.onTouchStartFuntion;b[0].ontouchend=a.onTouchEndFuntion;b[0].ontouchmove=function(d){d.preventDefault()};b.bind("webkitAnimationEnd",function(){bench.push(b.css({top:-9,"-webkit-animation-name":null,"-webkit-animation-duration":null}))});return c}});
